<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸ¯ Adivina el NÃºmero con Ranking Online</title>

  <!-- Fuente -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">

  <!-- CSS externo -->
  <link rel="stylesheet" href="css/styles.css">

  <!-- Firebase compat SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>
  <div style="position:absolute; top:10px; left:20px; color:#fff; text-shadow:1px 1px 2px #000; font-weight:bold; font-size:1.2em; z-index:10000;">
    Mauricio Johansen
  </div>

  <!-- Audio -->
  <audio id="musicaFondo" loop>
    <source src="musica.mp3" type="audio/mpeg">
  </audio>
  <button class="audio-btn" id="btnMusica">ğŸ”‡</button>

  <div class="container">
    <!-- Juego -->
    <div class="card">
      <h1 style="text-align:center;">ğŸ¯ Adivina el NÃºmero</h1>
      <input id="nombreJugador" placeholder="Tu nombre" />
      <select id="dificultad">
        <option value="">-- SeleccionÃ¡ nivel --</option>
        <option value="facil">FÃ¡cil (1-10)</option>
        <option value="medio">Medio (1-20)</option>
        <option value="dificil">DifÃ­cil (1-50)</option>
        <option value="extremo">Extremo (1-100, 30s)</option>
      </select>
      <p id="rango" style="margin:5px 0;"></p>
      <input type="number" id="numeroIngresado" disabled placeholder="Ingresa tu nÃºmero" />
      <button id="btnAdivinar" disabled>Adivinar</button>
      <button id="btnReiniciar">ğŸ”„ Reiniciar</button>
      <button id="btnCambiar">Cambiar jugador</button>
      <p id="mensaje" style="min-height:1.5em;"></p>
      <p id="intentos">Intentos: 0</p>
      <p id="temporizador"></p>
      <div id="barraTiempo"></div>
    </div>

    <!-- Ranking -->
    <div class="panel">
      <h2 style="text-align:center;">ğŸ† Ranking Online</h2>
      <ul id="rankingOnline"></ul>
    </div>
  </div>

  <!-- Mensaje secreto -->
  <div id="pantallaMensaje">Sol sucia, baÃ±ate ğŸ˜†</div>

  <!-- Confetti -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <!-- LÃ³gica JavaScript -->
  <script>
    // --- Firebase init ---
    const firebaseConfig = {
      apiKey: "AIzaSyAsbcsyB4h_AdMI_DZnvdql5CqhdzCNdH4",
      authDomain: "adivina-numero-ranking.firebaseapp.com",
      databaseURL: "https://adivina-numero-ranking-default-rtdb.firebaseio.com",
      projectId: "adivina-numero-ranking",
      storageBucket: "adivina-numero-ranking.appspot.com",
      messagingSenderId: "574261292288",
      appId: "1:574261292288:web:6d6673c104e0e2aa0857e5"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // --- Ranking en tiempo real ---
    db.ref('rankings').orderByChild('intentos').limitToFirst(10)
      .on('value', snap => {
        const ul = document.getElementById('rankingOnline');
        ul.innerHTML = '';
        snap.forEach(c => {
          const { nombre, nivel, intentos } = c.val();
          const li = document.createElement('li');
          li.textContent = `${nombre} â€” ${nivel} â€” ${intentos} intento(s)`;
          ul.appendChild(li);
        });
      });

    function enviarRanking(nombre, nivel, intentos) {
      db.ref('rankings').push().set(
        { nombre, nivel, intentos, ts: Date.now() },
        e => { if (e) console.error(e); }
      );
    }

    // --- LÃ³gica del juego ---
    let secreto, maxNum, intCount, adivinado, tiempoRest, timer;

    function iniciarJuego() {
      const nom = document.getElementById('nombreJugador').value.trim();
      if (!nom) return alert('IngresÃ¡ tu nombre');
      const nivel = document.getElementById('dificultad').value;
      if (!nivel) return;
      clearInterval(timer);
      if (nivel === 'facil') { maxNum = 10; tiempoRest = 60; }
      else if (nivel === 'medio') { maxNum = 20; tiempoRest = 60; }
      else if (nivel === 'dificil') { maxNum = 50; tiempoRest = 60; }
      else { maxNum = 100; tiempoRest = 30; }
      secreto = Math.floor(Math.random() * maxNum) + 1;
      intCount = 0;
      adivinado = false;
      document.getElementById('rango').textContent = `Entre 1 y ${maxNum}`;
      ['mensaje','temporizador'].forEach(id => document.getElementById(id).textContent = '');
      document.getElementById('intentos').textContent = 'Intentos: 0';
      const inp = document.getElementById('numeroIngresado');
      inp.value = '';
      inp.disabled = false;
      document.getElementById('btnAdivinar').disabled = false;
      inp.focus();
      iniciarTemporizador(nivel);
      confetti({ particleCount: 0 });
    }

    function verificar() {
      if (adivinado) return;
      const val = +document.getElementById('numeroIngresado').value;
      if (!val || val < 1 || val > maxNum) return;
      intCount++;
      document.getElementById('intentos').textContent = `Intentos: ${intCount}`;
      if (val === secreto) {
        adivinado = true;
        clearInterval(timer);
        const nom = document.getElementById('nombreJugador').value;
        document.getElementById('mensaje').textContent = `ğŸ‰ Â¡${nom}, acertaste en ${intCount}!`;
        confetti({ particleCount:150, spread:100, origin:{y:0.6} });
        enviarRanking(nom, document.getElementById('dificultad').value, intCount);
      } else {
        document.getElementById('mensaje').textContent = val < secreto ? 'ğŸ“‰ Muy bajo' : 'ğŸ“ˆ Muy alto';
      }
    }

    function iniciarTemporizador(nivel) {
      if (nivel === 'facil') return;
      document.getElementById('barraTiempo').style.width = '100%';
      timer = setInterval(() => {
        tiempoRest--;
        document.getElementById('temporizador').textContent = `â³ ${tiempoRest}s`;
        const tot = (nivel === 'extremo') ? 30 : 60;
        document.getElementById('barraTiempo').style.width = `${(tiempoRest/tot)*100}%`;
        if (tiempoRest <= 0) {
          clearInterval(timer);
          document.getElementById('mensaje').textContent = `â›” Se acabÃ³ el tiempo, era ${secreto}`;
          document.getElementById('btnAdivinar').disabled = true;
        }
      }, 1000);
    }

    function reiniciar() {
      clearInterval(timer);
      iniciarJuego();
    }

    function cambiarJugador() {
      clearInterval(timer);
      ['nombreJugador','dificultad','numeroIngresado'].forEach(id => document.getElementById(id).value = '');
      ['numeroIngresado','btnAdivinar'].forEach(id => document.getElementById(id).disabled = true);
      ['mensaje','temporizador','rango','intentos'].forEach(id => 
        document.getElementById(id).textContent = id === 'intentos' ? 'Intentos: 0' : ''
      );
    }

    // --- Audio toggle ---
    function toggleMusica() {
      const m = document.getElementById('musicaFondo'),
            b = document.getElementById('btnMusica');
      if (m.paused) {
        m.play();
        b.textContent = 'ğŸ”Š';
        b.style.background = '#28a745';
      } else {
        m.pause();
        b.textContent = 'ğŸ”‡';
        b.style.background = '#dc3545';
      }
    }

    // --- Bind events ---
    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('dificultad').addEventListener('change', iniciarJuego);
      document.getElementById('btnAdivinar').addEventListener('click', verificar);
      document.getElementById('btnReiniciar').addEventListener('click', reiniciar);
      document.getElementById('btnCambiar').addEventListener('click', cambiarJugador);
      document.getElementById('btnMusica').addEventListener('click', toggleMusica);
    });
  </script>
</body>
</html>
