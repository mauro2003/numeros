<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üéØ Adivina el N√∫mero con Ranking Online</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin:0; padding:0; }
    body {
      font-family:'Poppins',sans-serif;
      background: linear-gradient(-45deg,#ff9a9e,#fad0c4,#a1c4fd,#c2e9fb);
      background-size:400% 400%; animation:moverFondo 10s ease infinite;
      display:flex; justify-content:center; padding:20px;
    }
    @keyframes moverFondo { 0%{background-position:0 50%}50%{background-position:100% 50%}100%{background-position:0 50%} }
    .container {
      display:grid; grid-template-columns:1fr 1fr; gap:30px;
      max-width:900px; width:100%;
    }
    .card, .panel {
      background:rgba(255,255,255,0.9); padding:30px; border-radius:15px;
      box-shadow:0 4px 15px rgba(0,0,0,0.2); animation:fadeIn .6s ease-in;
    }
    @keyframes fadeIn { from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)} }
    .card { display:flex; flex-direction:column; }
    input, select, button {
      width:100%; padding:10px; margin:10px 0;
      border:1px solid #ccc; border-radius:8px; font-size:1em;
    }
    button { background:#007bff; color:#fff; font-weight:bold; cursor:pointer; border:none; }
    button:hover { background:#0056b3; }
    #barraTiempo {
      height:10px; background:#28a745; transition:width 1s;
      width:100%; border-radius:5px; margin-top:10px;
    }
    ul { list-style:none; padding-left:0; margin-top:0; }
    ul li { margin:5px 0; }
    #pantallaMensaje {
      position:fixed; top:0; left:0; width:100%; height:100%;
      background:#000; color:#fff; display:none;
      align-items:center; justify-content:center; font-size:3em; z-index:9999;
      text-align:center;
    }
    .audio-btn {
      position:fixed; top:20px; right:20px;
      width:40px; height:40px; font-size:20px;
      background:#dc3545; color:#fff; border:none; border-radius:10px;
      cursor:pointer; box-shadow:0 2px 6px rgba(0,0,0,0.3); z-index:10000;
      display:flex; align-items:center; justify-content:center;
    }
    @media(max-width:768px) {
      .container { grid-template-columns:1fr; }
      .audio-btn { top:10px; right:10px; width:36px; height:36px; font-size:18px; }
    }
  </style>
  <!-- Firebase compat SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>
  <!--<div style="position:absolute;top:10px;left:20px;color:#fff;text-shadow:1px 1px 2px #000;font-weight:bold;font-size:1.2em;z-index:10000;">Mauricio Johansen</div>-->
  <audio id="musicaFondo" loop>
    <source src="musica.mp3" type="audio/mpeg">
  </audio>
  <button class="audio-btn" id="btnMusica">üîá</button>

  <div class="container">
    <div class="card">
      <h1 style="text-align:center;">üéØ Adivina el N√∫mero</h1>
      <input id="nombreJugador" placeholder="Tu nombre" />
      <select id="dificultad">
        <option value="">-- Nivel --</option>
        <option value="facil">F√°cil (1-10)</option>
        <option value="medio">Medio (1-20)</option>
        <option value="dificil">Dif√≠cil (1-50)</option>
        <option value="extremo">Extremo (1-100, 30s)</option>
      </select>
      <p id="rango" style="margin:5px 0;"></p>
      <input type="number" id="numeroIngresado" disabled placeholder="Ingresa tu n√∫mero" />
      <button id="btnAdivinar" disabled>Adivinar</button>
      <button id="btnReiniciar">üîÑ Reiniciar</button>
      <button id="btnCambiar">Cambiar jugador</button>
      <p id="mensaje" style="min-height:1.5em;"></p>
      <p id="intentos">Intentos: 0</p>
      <p id="temporizador"></p>
      <div id="barraTiempo"></div>
    </div>
    <div class="panel">
      <h2 style="text-align:center;">üèÜ Ranking Online</h2>
      <ul id="rankingOnline"></ul>
    </div>
  </div>
  <div id="pantallaMensaje">Sol sucia, ba√±ate üòÜ</div>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script>
    // Configuraci√≥n Firebase
    const firebaseConfig = {
      apiKey:"AIzaSyAsbcsyB4h_AdMI_DZnvdql5CqhdzCNdH4",
      authDomain:"adivina-numero-ranking.firebaseapp.com",
      databaseURL:"https://adivina-numero-ranking-default-rtdb.firebaseio.com",
      projectId:"adivina-numero-ranking",
      storageBucket:"adivina-numero-ranking.appspot.com",
      messagingSenderId:"574261292288",
      appId:"1:574261292288:web:6d6673c104e0e2aa0857e5"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Variables de juego y tiempo
    let secreto, maxNum, intCount, adivinado, startTime, timer;

    // Listener ranking con orden custom
    db.ref('rankings').on('value', snap => {
      const arr = [];
      snap.forEach(c => arr.push(c.val()));
      // Ordenar por dificultad desc, intentos asc, seconds asc
      const order = { extremo:4, dificil:3, medio:2, facil:1 };
      arr.sort((a,b) => {
        if (order[b.nivel] !== order[a.nivel]) return order[b.nivel] - order[a.nivel];
        if (a.intentos !== b.intentos) return a.intentos - b.intentos;
        return a.seconds - b.seconds;
      });
      const ul = document.getElementById('rankingOnline');ul.innerHTML='';
      arr.slice(0,10).forEach(e => {
        const li = document.createElement('li');
        li.textContent = `${e.nombre} ‚Äî ${e.nivel} ‚Äî ${e.intentos} intento(s) ‚Äî ${e.seconds}s`;
        ul.appendChild(li);
      });
    });

    function enviarRanking(nombre,nivel,intentos,seconds){
      db.ref('rankings').push().set({nombre,nivel,intentos,seconds,ts:Date.now()},e=>{
        if(e) console.error(e);
      });
    }

    // Funciones del juego
    function iniciarJuego(){
      const nom = document.getElementById('nombreJugador').value.trim();
      if(!nom) return alert('Ingres√° tu nombre');
      const nivel = document.getElementById('dificultad').value;
      if(!nivel) return;
      clearInterval(timer);
      switch(nivel){case'facil':maxNum=10;break;case'medio':maxNum=20;break;case'dificil':maxNum=50;break;case'extremo':maxNum=100;startTime=30;break;}
      secreto = Math.floor(Math.random()*maxNum)+1;
      intCount = 0; adivinado=false;
      startTime = Date.now(); // para medir segundos
      document.getElementById('rango').textContent = `Entre 1 y ${maxNum}`;
      ['mensaje','temporizador'].forEach(id=>document.getElementById(id).textContent='');
      document.getElementById('intentos').textContent = 'Intentos: 0';
      const inp = document.getElementById('numeroIngresado'); inp.value=''; inp.disabled=false;
      document.getElementById('btnAdivinar').disabled=false;
      inp.focus(); iniciarTemporizador(nivel);
      confetti({particleCount:0});
    }

    function verificar(){
      if(adivinado) return;
      const val = +document.getElementById('numeroIngresado').value;
      if(!val||val<1||val>maxNum) return;
      intCount++;
      document.getElementById('intentos').textContent = `Intentos: ${intCount}`;
      if(val===secreto){
        adivinado=true; clearInterval(timer);
        const nom = document.getElementById('nombreJugador').value;
        const sec = Math.floor((Date.now()-startTime)/1000);
        document.getElementById('mensaje').textContent = `üéâ ¬°${nom}, acertaste en ${intCount} intento(s) y ${sec}s!`;
        confetti({particleCount:150,spread:100,origin:{y:0.6}});
        enviarRanking(nom, document.getElementById('dificultad').value, intCount, sec);
      } else {
        document.getElementById('mensaje').textContent = val<secreto?'üìâ Muy bajo':'üìà Muy alto';
      }
    }

    function iniciarTemporizador(nivel){
      if(nivel==='facil') return;
      // ... puedes agregar temporizador si deseas...
    }

    function reiniciar(){ clearInterval(timer); iniciarJuego(); }
    function cambiarJugador(){
      clearInterval(timer);
      ['nombreJugador','dificultad','numeroIngresado'].forEach(id=>document.getElementById(id).value='');
      ['numeroIngresado','btnAdivinar'].forEach(id=>document.getElementById(id).disabled=true);
      ['mensaje','temporizador','rango','intentos'].forEach(id=>document.getElementById(id).textContent=id==='intentos'?'Intentos: 0':'');
    }

    function toggleMusica(){
      const m=document.getElementById('musicaFondo'),b=document.getElementById('btnMusica');
      if(m.paused){m.play();b.textContent='üîä';b.style.background='#28a745';}
      else{m.pause();b.textContent='üîá';b.style.background='#dc3545';}
    }

    document.addEventListener('DOMContentLoaded',()=>{
      document.getElementById('dificultad').addEventListener('change', iniciarJuego);
      document.getElementById('btnAdivinar').addEventListener('click', verificar);
      document.getElementById('btnReiniciar').addEventListener('click', reiniciar);
      document.getElementById('btnCambiar').addEventListener('click', cambiarJugador);
      document.getElementById('btnMusica').addEventListener('click', toggleMusica);
    });
  </script>
</body>
</html>
